<div class="bars">
  <ul>
  {{#each parsedBars as bar}}
    <li>
      <ul>
        <li>
          <span>{{bar.index}}</span>
          {{#each bar.spans as span}}
            {{#if span}}
              <span class="{{spanStyle(bar.index, span.tick)}}">{{span.text}}</span>
            {{/if}}
          {{/each}}
        </li>
      </ul>
    </li>
  {{/each}}
  </ul>
</div>

<script>
  import { autorun } from 'mobx';
  import store from './store/store';
  import spanner from './helpers/spanner'

  export default {
    oncreate () {
      // Connect mobx
      this.autorunDisposer = autorun(() => {
        this.set({
          bars: store.bars
        });
      });

      this.autorunDisposer = autorun(() => {
        this.set({
          position: store.position
        });
      });
    },

    data () {
      return {
        bars: [],
        position: {
          bar: 0,
          tick: 1
        }
      };
    },

    computed: {
      parsedBars: (bars) => {
        const result = bars.map((bar, index) => {
          const spans = spanner(bar);
          return {
            index: index + 1,
            text: bar,
            spans: spans
          };
        });

        console.log(result);
        return result;
      },
      barStyle: (position) => {
        return (index) => {
          return position.bar > index
            ? 'past'
            : position.bar === index
              ? 'current'
              : '';
        };
      },
      spanStyle: (position) => {
        return (bar, tick) => {
          return bar < position.bar
            ? 'past'
            : bar === position.bar
              ? tick < position.tick
                ? 'past'
                : tick === position.tick
                  ? 'current'
                  : ''
              : '';
        };
      }
    }
  };
</script>

<style>
  .bars {
    flex-grow: 1;
    font-family: Courier New, Courier, monospace;
  }
  ul {
    list-style-type: none;
  }
  .past {
    font-weight: bold;
  }
  .current {
    font-weight: bold;
    color: blueviolet;
  }
</style>